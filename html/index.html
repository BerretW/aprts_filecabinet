<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Cabinet Final</title>
    
    <!-- Hlavní styly -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Vue 3 Framework -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Quill Text Editor (CSS + JS) -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    
    <!-- FontAwesome Ikony -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div id="app">
        <!-- Overlay s v-cloak (skryje Vue syntaxi před načtením) -->
        <div class="overlay" v-if="visible" v-cloak>
            
            <!-- Hlavní kontejner (Deska stolu) -->
            <div class="desk-surface">
                
                <!-- LEVÝ PANEL: KARTOTÉKA (ŠUPLÍK) -->
                <!-- Zobrazí se pouze, pokud nejsme v režimu prohlížení jednoho souboru z inventáře -->
                <div class="cabinet-drawer" v-if="!isSingleFileView">
                    
                    <div class="drawer-header">
                        <h2>{{ cabinetName }}</h2>
                        <div class="stats-row">
                            <span class="stat-badge">
                                <i class="fa-solid fa-file"></i> {{ files.length }} Spisů
                            </span>
                            <span class="stat-badge" :class="{'danger': emptyPapersCount <= 0}">
                                <i class="fa-solid fa-scroll"></i> {{ emptyPapersCount }} Papírů
                            </span>
                        </div>
                        
                        <!-- Vyhledávací pole -->
                        <div class="search-bar">
                            <i class="fa-solid fa-magnifying-glass"></i>
                            <input type="text" v-model="searchQuery" placeholder="Hledat jméno, spis...">
                        </div>
                    </div>

                    <!-- Seznam spisů (Filtrovaný) -->
                    <div class="drawer-list">
                        <div 
                            v-for="(file, index) in filteredFiles" 
                            :key="index" 
                            class="drawer-item" 
                            :class="{ active: selectedFile === file }"
                            @click="selectFile(file)"
                        >
                            <div class="item-icon">
                                <!-- Ikony podle typu dokumentu -->
                                <i v-if="getFileType(file) === 'medical_report'" class="fa-solid fa-user-doctor" style="color: #d32f2f;"></i>
                                <i v-else-if="getFileType(file) === 'police_report'" class="fa-solid fa-shield-halved" style="color: #1976d2;"></i>
                                <i v-else class="fa-solid fa-file-lines" style="color: #8d6e63;"></i>
                            </div>
                            <div class="item-content">
                                <span class="item-title">{{ getFileTitle(file) }}</span>
                                <span class="item-meta">{{ getFileLabel(file) }}</span>
                            </div>
                        </div>

                        <!-- Pokud filtr nic nenašel -->
                        <div v-if="filteredFiles.length === 0" class="no-results">
                            <i class="fa-regular fa-folder-open"></i>
                            <p>Žádné spisy nenalezeny.</p>
                        </div>
                    </div>

                    <div class="drawer-footer">
                        <button class="btn-primary" @click="startCreating" :disabled="emptyPapersCount <= 0">
                            <i class="fa-solid fa-plus"></i> Nový Záznam
                        </button>
                        <button class="btn-secondary" @click="closeMenu">
                            <i class="fa-solid fa-xmark"></i> Zavřít
                        </button>
                    </div>
                </div>

                <!-- PRAVÝ PANEL: DOKUMENT (PAPÍR) -->
                <!-- Pokud je single view, přidáme třídu pro vycentrování -->
                <div class="document-area" :class="{ 'single-view-centered': isSingleFileView }">
                    
                    <!-- STAV 1: Nic nevybráno (zobrazí se jen při práci s kartotékou) -->
                    <div v-if="mode === 'none'" class="empty-state">
                        <i class="fa-solid fa-arrow-left-long"></i>
                        <h3>Vyberte spis ze seznamu</h3>
                        <p>nebo založte nový záznam tlačítkem vlevo.</p>
                    </div>

                    <!-- STAV 2: Zobrazený papír (Čtení nebo Editace) -->
                    <div v-else class="paper-sheet">
                        
                        <!-- A) REŽIM ČTENÍ (READ MODE) -->
                        <div v-if="mode === 'read'" class="read-mode">
                            <div class="doc-header">
                                <div class="stamp">{{ getFileLabel(selectedFile) }}</div>
                                <h1>{{ getFileTitle(selectedFile) }}</h1>
                            </div>
                            
                            <!-- 1. Standardní text (Quill HTML) -->
                            <div v-if="getFileType(selectedFile) === 'standard'" class="doc-body ql-editor" v-html="getFileContent(selectedFile)"></div>

                            <!-- 2. Formulář (Grid System) -->
                            <div v-else class="form-grid">
                                <div 
                                    v-for="field in getFormFields(selectedFile)" 
                                    :key="field.key" 
                                    class="grid-item"
                                    :class="'width-' + (field.width || 'full')"
                                >
                                    <label>{{ field.label }}</label>
                                    <div class="value">{{ getFormFieldValue(selectedFile, field.key) }}</div>
                                </div>
                            </div>

                            <!-- Tlačítka akcí pod dokumentem -->
                            <div class="doc-actions">
                                <!-- Tlačítko Zpět (jen v kartotéce) -->
                                <button class="btn-secondary" @click="mode = 'none'" v-if="!isSingleFileView">
                                    <i class="fa-solid fa-angle-left"></i> Zpět
                                </button>

                                <!-- Tlačítko Zavřít (jen při prohlížení z inventáře) -->
                                <button class="btn-secondary" @click="closeMenu" v-if="isSingleFileView">
                                    <i class="fa-solid fa-xmark"></i> Zavřít
                                </button>
                                    <button 
                                        class="btn-secondary" 
                                        @click="copyFile(selectedFile)" 
                                        v-if="!isSingleFileView" 
                                        :disabled="emptyPapersCount <= 0"
                                        title="Vytvořit kopii (Stojí 1 papír)"
                                    >
                                        <i class="fa-solid fa-copy"></i> Kopírovat
                                    </button>
                                <!-- Tlačítko Editovat (jen v kartotéce) -->
                                <button class="btn-stamp" @click="startEditing(selectedFile)" v-if="!isSingleFileView">
                                    <i class="fa-solid fa-pen-to-square"></i> Editovat
                                </button>
                            </div>
                        </div>

                        <!-- B) REŽIM PSANÍ / EDITACE (CREATE/EDIT MODE) -->
                        <div v-else-if="mode === 'create' || mode === 'edit'" class="create-mode">
                            <div class="doc-header edit-header">
                                <h3>{{ mode === 'create' ? 'Nový dokument' : 'Editace dokumentu' }}</h3>
                                <!-- Výběr typu (Medical, Police, Standard...). Při editaci zakázáno. -->
                                <select v-model="newFile.type" @change="onTypeChange" :disabled="mode === 'edit'">
                                    <option v-for="(cfg, key) in docTypes" :value="key">{{ cfg.label }}</option>
                                </select>
                            </div>

                            <!-- Název spisu -->
                            <div class="form-group title-group">
                                <input type="text" v-model="newFile.title" placeholder="Zadejte název spisu..." class="input-title" maxlength="40">
                            </div>

                            <!-- 1. Quill Editor (pro volný text) -->
                            <div v-show="docTypes[newFile.type] && !docTypes[newFile.type].isForm" class="editor-wrapper">
                                <div id="quill-editor"></div>
                            </div>

                            <!-- 2. Form Editor (pro formuláře s Gridem) -->
                            <div 
                                v-if="docTypes[newFile.type] && docTypes[newFile.type].isForm" 
                                class="form-grid edit-grid"
                            >
                                <div 
                                    v-for="field in docTypes[newFile.type].fields" 
                                    :key="field.key" 
                                    class="grid-item"
                                    :class="'width-' + (field.width || 'full')"
                                >
                                    <label>{{ field.label }}</label>
                                    
                                    <!-- Input type TEXT -->
                                    <input 
                                        v-if="field.type === 'text'" 
                                        type="text" 
                                        v-model="newFile.formData[field.key]"
                                        autocomplete="off"
                                    >
                                    
                                    <!-- Input type TEXTAREA (s dynamickými řádky) -->
                                    <textarea 
                                        v-else-if="field.type === 'textarea'" 
                                        v-model="newFile.formData[field.key]" 
                                        :rows="field.rows || 3"
                                    ></textarea>
                                </div>
                            </div>

                            <!-- Tlačítka Uložit / Zrušit -->
                            <div class="doc-actions">
                                <button @click="cancelEditCreate" class="btn-text">Zrušit</button>
                                <button @click="saveFile" class="btn-stamp">
                                    <i class="fa-solid fa-floppy-disk"></i> Uložit
                                </button>
                            </div>
                        </div>

                    </div>
                </div>

            </div>
        </div>
    </div>
    
    <!-- Logika Vue aplikace -->
    <script src="script.js"></script>
</body>
</html>